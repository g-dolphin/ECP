# this step is only there for special cases (1A2, 1A3b, 3C1). If these categories
# have no price, but subcategories do, then we calculate the emissions-weighted
# average across subcategories and use the result.
df['acp']<-NA
for(i in 1:nrow(df)){
# find all subcategories
tmpnms<-vector()
tmpnms<-df[startsWith(df$Sat_ind, df$Sat_ind[i]),1]
tmpnms<-tmpnms[-1] # keep only subcategories
# get prices for those subcategories
tmpvectp<-df$cp[df$Sat_ind %in% tmpnms]
# get carbon for those subcategories
tmpvectc<-df$emissions[df$Sat_ind %in% tmpnms]
# if the main category has no aggregate price, but subcategories do,
# we use the emissions-weighted average price across subcategories
if (df$cp[i] == 0 & sum(tmpvectp) > 0 & sum(tmpvectc) > 0) {
df$acp[i] <- sum(tmpvectp*tmpvectc)/sum(tmpvectc)
} else { # otherwise we use the price of the main category (it might be 0)
df$acp[i] <- df$cp[i]
}
}
### Step 9: Calculate overall emissions-weighted carbon price for the sector
# divide categorical emissions by total
df['relem']<-df$emissions/df$emissions[df$Sat_ind=="total"]
# if we have zero total emissions this introduces NAs. Change those cases to zero
# df$relem[is.na(df$relem)]<-0
# multiply relative emissions by categorical prices
df['relcc']<-df$relem*df$acp
df$relcc[df$Sat_ind=="total"]<-0
# result is the sum of all categorical weighted prices
result<-sum(df$relcc)
### Step 10: Return result
return(result)
}
#################
r=17041
# idenify country
tmpc<-fcq[r] # the country
# identify sector
tmps<-fsq[r] # the sector
# then run
for(j in 1:length(cpal)){ # loop across carbon price accounts defined in cpal
print(j)
zq[nr+j,r]<-calculate_ewcp(yr = yr,
indx=r,
ecp_jur = countryconc$c_ecp[countryconc$c_gloria==tmpc],
sattype = cpal[[j]][[1]],
cptype = cpal[[j]][[2]],
etype = cpal[[j]][[3]],
ftype = cpal[[j]][[4]],
ctry = tmpc,
sect = tmps,
ecp_data = ecp,
gloria_q_data = zq,
concordance = conclist[[tmps]],
type = "z",
sector_ind = sector_ind,
demand_ind = demand_ind)
}
#################
r=17042
# idenify country
tmpc<-fcq[r] # the country
# identify sector
tmps<-fsq[r] # the sector
# then run
for(j in 1:length(cpal)){ # loop across carbon price accounts defined in cpal
print(j)
zq[nr+j,r]<-calculate_ewcp(yr = yr,
indx=r,
ecp_jur = countryconc$c_ecp[countryconc$c_gloria==tmpc],
sattype = cpal[[j]][[1]],
cptype = cpal[[j]][[2]],
etype = cpal[[j]][[3]],
ftype = cpal[[j]][[4]],
ctry = tmpc,
sect = tmps,
ecp_data = ecp,
gloria_q_data = zq,
concordance = conclist[[tmps]],
type = "z",
sector_ind = sector_ind,
demand_ind = demand_ind)
}
### Setup
wd<-file.path(here::here(),"_code","compilation","ecp","industry")
setwd(wd)
### Import data
gversion<-"059"
tmpmat=T
gloriawd<-file.path(wd,"1_import","gloria")
if(gversion=="059"){
if(isTRUE(tmpmat)){
source(file.path(gloriawd,"run_imports_v59_mat.R"))
} else {
source(file.path(gloriawd,"run_imports_v59.R"))
}
} else if(gversion=="057"){
source(file.path(gloriawd,"run_imports_v57.R"))
}
pl<-"cons_p"
ecpwd<-file.path(wd,"1_import","ecp")
source(file.path(ecpwd,"import_ecp.R"))
### Datamatch
ecpmwd<-file.path(wd,"2_match")
source(file.path(ecpmwd,"match_gloria_ecp.R"))
### Reformat and Save
for(j in 1:length(cpal)){
cpal[[j]]<-unlist(paste(cpal[[j]],collapse="_"))
}
cpinds<-unlist(cpal)
rm(cpal)
yrs<-seq(1990,2022)
zql<-list()
yql<-list()
for(i in 1:length(yrs)){
## 1. Fetch data
load(file.path(ecpmwd,"tmpdir",yrs[i],"ecp_gloria.RData"))
## 2. Get industry level data
zqdf<-as.data.frame(matrix(nrow=nrow(sequential_ind),ncol=4))
colnames(zqdf)<-c("year","country_sector","country","sector")
zqdf$year<-yrs[i]
zqdf$country_sector<-sequential_ind$Sequential_regionSector_labels
zqdf$country<-sequential_ind$fcq
zqdf$sector<-sequential_ind$fsq
# find carbon prices and bind to zqdf
nrcps<-nrow(satellites_ind)+1
nrcpf<-nrow(satellites_ind)+length(cpinds)
zcp<-t(zq[nrcps:nrcpf,])
colnames(zcp)<-cpinds
zqdf<-cbind(zqdf,zcp)
rm(nrcps,nrcpf,zcp)
# add emissions columns
zqdf['co2_edgar_total']<-zq[which(grepl("EDGAR",satellites_ind$Sat_head_indicator) & grepl("c_total",satellites_ind$Sat_indicator)),]
zqdf['co2_edgar_1a']<-zq[which(grepl("EDGAR",satellites_ind$Sat_head_indicator) & grepl("c_1A",satellites_ind$Sat_indicator)),] %>% colSums()
zqdf['co2_edgar_1b']<-zq[which(grepl("EDGAR",satellites_ind$Sat_head_indicator) & grepl("c_1B",satellites_ind$Sat_indicator)),] %>% colSums()
zqdf['co2_edgar_2']<-zq[which(grepl("EDGAR",satellites_ind$Sat_head_indicator) & grepl("c_2",satellites_ind$Sat_indicator)),] %>% colSums()
zqdf['co2_edgar_3']<-zq[which(grepl("EDGAR",satellites_ind$Sat_head_indicator) & grepl("c_3",satellites_ind$Sat_indicator)),] %>% colSums()
zqdf['co2_edgar_4']<-zq[which(grepl("EDGAR",satellites_ind$Sat_head_indicator) & grepl("c_4",satellites_ind$Sat_indicator)),] %>% colSums()
zqdf['co2_edgar_5']<-zq[which(grepl("EDGAR",satellites_ind$Sat_head_indicator) & grepl("c_5",satellites_ind$Sat_indicator)),] %>% colSums()
zqdf['co2_oecd_total']<-zq[which(grepl("OECD",satellites_ind$Sat_head_indicator) & grepl("c_total",satellites_ind$Sat_indicator)),]
zqdf['co2_oecd_1a']<-zq[which(grepl("OECD",satellites_ind$Sat_head_indicator) & grepl("c_1A",satellites_ind$Sat_indicator)),] %>% colSums()
zqdf['co2_oecd_1b']<-zq[which(grepl("OECD",satellites_ind$Sat_head_indicator) & grepl("c_1B",satellites_ind$Sat_indicator)),] %>% colSums()
zqdf['co2_oecd_2']<-zq[which(grepl("OECD",satellites_ind$Sat_head_indicator) & grepl("c_2",satellites_ind$Sat_indicator)),] %>% colSums()
zqdf['co2_oecd_3']<-zq[which(grepl("OECD",satellites_ind$Sat_head_indicator) & grepl("c_3",satellites_ind$Sat_indicator)),] %>% colSums()
zqdf['co2_oecd_4']<-zq[which(grepl("OECD",satellites_ind$Sat_head_indicator) & grepl("c_4",satellites_ind$Sat_indicator)),] %>% colSums()
zqdf['co2_oecd_5']<-zq[which(grepl("OECD",satellites_ind$Sat_head_indicator) & grepl("c_5",satellites_ind$Sat_indicator)),] %>% colSums()
# move into list element
zql[[i]]<-zqdf
rm(zqdf)
## 3. Get demand level data
yqdf<-as.data.frame(matrix(nrow=nrow(sequentiald_ind),ncol=4))
colnames(yqdf)<-c("year","country_sector","country","sector")
yqdf$year<-yrs[i]
yqdf$country_sector<-sequentiald_ind$Sequential_finalDemand_labels
yqdf$country<-sequentiald_ind$fcqd
yqdf$sector<-sequentiald_ind$demandind
# find carbon prices and bind to yqdf
nrcps<-nrow(satellites_ind)+1
nrcpf<-nrow(satellites_ind)+length(cpinds)
ycp<-t(yq[nrcps:nrcpf,])
colnames(ycp)<-cpinds
yqdf<-cbind(yqdf,ycp)
rm(nrcps,nrcpf,ycp)
# total emissions row is given by satellites_ind
# add emissions columns
yqdf['co2_edgar_total']<-yq[which(grepl("EDGAR",satellites_ind$Sat_head_indicator) & grepl("c_total",satellites_ind$Sat_indicator)),]
yqdf['co2_edgar_1a']<-yq[which(grepl("EDGAR",satellites_ind$Sat_head_indicator) & grepl("c_1A",satellites_ind$Sat_indicator)),] %>% colSums()
yqdf['co2_edgar_1b']<-yq[which(grepl("EDGAR",satellites_ind$Sat_head_indicator) & grepl("c_1B",satellites_ind$Sat_indicator)),] %>% colSums()
yqdf['co2_edgar_2']<-yq[which(grepl("EDGAR",satellites_ind$Sat_head_indicator) & grepl("c_2",satellites_ind$Sat_indicator)),] %>% colSums()
yqdf['co2_edgar_3']<-yq[which(grepl("EDGAR",satellites_ind$Sat_head_indicator) & grepl("c_3",satellites_ind$Sat_indicator)),] %>% colSums()
yqdf['co2_edgar_4']<-yq[which(grepl("EDGAR",satellites_ind$Sat_head_indicator) & grepl("c_4",satellites_ind$Sat_indicator)),] %>% colSums()
yqdf['co2_edgar_5']<-yq[which(grepl("EDGAR",satellites_ind$Sat_head_indicator) & grepl("c_5",satellites_ind$Sat_indicator)),] %>% colSums()
yqdf['co2_oecd_total']<-yq[which(grepl("OECD",satellites_ind$Sat_head_indicator) & grepl("c_total",satellites_ind$Sat_indicator)),]
yqdf['co2_oecd_1a']<-yq[which(grepl("OECD",satellites_ind$Sat_head_indicator) & grepl("c_1A",satellites_ind$Sat_indicator)),] %>% colSums()
yqdf['co2_oecd_1b']<-yq[which(grepl("OECD",satellites_ind$Sat_head_indicator) & grepl("c_1B",satellites_ind$Sat_indicator)),] %>% colSums()
yqdf['co2_oecd_2']<-yq[which(grepl("OECD",satellites_ind$Sat_head_indicator) & grepl("c_2",satellites_ind$Sat_indicator)),] %>% colSums()
yqdf['co2_oecd_3']<-yq[which(grepl("OECD",satellites_ind$Sat_head_indicator) & grepl("c_3",satellites_ind$Sat_indicator)),] %>% colSums()
yqdf['co2_oecd_4']<-yq[which(grepl("OECD",satellites_ind$Sat_head_indicator) & grepl("c_4",satellites_ind$Sat_indicator)),] %>% colSums()
yqdf['co2_oecd_5']<-yq[which(grepl("OECD",satellites_ind$Sat_head_indicator) & grepl("c_5",satellites_ind$Sat_indicator)),] %>% colSums()
# move into list element
yql[[i]]<-yqdf
rm(yqdf)
}
zqd<-do.call("rbind",zql)
yqd<-do.call("rbind",yql)
# we save seperate these files separately due to GitHub restrictions on file size
if(pl=="curr_p"){
# current price, industry level, edgar based, aggregate ecp, with carbon info
write.csv(zqd %>% select(year,country_sector,country,sector,EDGAR_ecp_all_all,contains("co2_edgar")) %>% rename(ecp_edgar = EDGAR_ecp_all_all),
file.path(here::here(),
"_dataset","ecp","industry","ecp_gloria_sectors",gversion,
"currentPrice","FlexXRate",
"ecp_gloria_edgar_industry_CO2.csv"),row.names = F)
# current price, industry level, edgar based, disaggregated prices
write.csv(zqd %>% select(contains("EDGAR")) %>% select(!contains("co2")),
file.path(here::here(),
"_dataset","ecp","industry","ecp_gloria_sectors",gversion,
"currentPrice","FlexXRate",
"ecp_gloria_edgar_industry_cpdisagg.csv"),row.names = F)
# current price, industry level, oecd based, aggregate ecp, with carbon info
write.csv(zqd %>% select(year,country_sector,country,sector,OECD_ecp_all_all,contains("co2_oecd")) %>% rename(ecp_oecd = OECD_ecp_all_all),
file.path(here::here(),
"_dataset","ecp","industry","ecp_gloria_sectors",gversion,
"currentPrice","FlexXRate",
"ecp_gloria_oecd_industry_CO2.csv"),row.names = F)
# current price, industry level, oecd based, disaggregated prices
write.csv(zqd %>% select(contains("OECD")) %>% select(!contains("co2")),
file.path(here::here(),
"_dataset","ecp","industry","ecp_gloria_sectors",gversion,
"currentPrice","FlexXRate",
"ecp_gloria_oecd_industry_cpdisagg.csv"),row.names = F)
# current price, demand level, edgar based, aggregate ecp, with carbon info
write.csv(yqd %>% select(year,country_sector,country,sector,EDGAR_ecp_all_all,contains("co2_edgar")) %>% rename(ecp_edgar = EDGAR_ecp_all_all),
file.path(here::here(),
"_dataset","ecp","industry","ecp_gloria_sectors",gversion,
"currentPrice","FlexXRate",
"ecp_gloria_edgar_finaldem_CO2.csv"),row.names = F)
# current price, demand level, edgar based, disaggregated prices
write.csv(yqd %>% select(contains("EDGAR")) %>% select(!contains("co2")),
file.path(here::here(),
"_dataset","ecp","industry","ecp_gloria_sectors",gversion,
"currentPrice","FlexXRate",
"ecp_gloria_edgar_finaldem_cpdisagg.csv"),row.names = F)
# current price, demand level, oecd based, aggregate ecp, with carbon info
write.csv(yqd %>% select(year,country_sector,country,sector,OECD_ecp_all_all,contains("co2_oecd")) %>% rename(ecp_oecd = OECD_ecp_all_all),
file.path(here::here(),
"_dataset","ecp","industry","ecp_gloria_sectors",gversion,
"currentPrice","FlexXRate",
"ecp_gloria_oecd_finaldem_CO2.csv"),row.names = F)
# current price, demand level, oecd based, disaggregated prices
write.csv(yqd %>% select(contains("OECD")) %>% select(!contains("co2")),
file.path(here::here(),
"_dataset","ecp","industry","ecp_gloria_sectors",gversion,
"currentPrice","FlexXRate",
"ecp_gloria_oecd_finaldem_cpdisagg.csv"),row.names = F)
} else if (pl=="cons_p"){
# constant price, industry level, edgar based, aggregate ecp, with carbon info
write.csv(zqd %>% select(year,country_sector,country,sector,EDGAR_ecp_all_all,contains("co2_edgar")) %>% rename(ecp_edgar = EDGAR_ecp_all_all),
file.path(here::here(),
"_dataset","ecp","industry","ecp_gloria_sectors",gversion,
"constantPrice","FixedXRate",
"ecp_gloria_edgar_industry_CO2.csv"),row.names = F)
# constant price, industry level, edgar based, disaggregated prices
write.csv(zqd %>% select(contains("EDGAR")) %>% select(!contains("co2")),
file.path(here::here(),
"_dataset","ecp","industry","ecp_gloria_sectors",gversion,
"constantPrice","FixedXRate",
"ecp_gloria_edgar_industry_cpdisagg.csv"),row.names = F)
# constant price, industry level, oecd based, aggregate ecp, with carbon info
write.csv(zqd %>% select(year,country_sector,country,sector,OECD_ecp_all_all,contains("co2_oecd")) %>% rename(ecp_oecd = OECD_ecp_all_all),
file.path(here::here(),
"_dataset","ecp","industry","ecp_gloria_sectors",gversion,
"constantPrice","FixedXRate",
"ecp_gloria_oecd_industry_CO2.csv"),row.names = F)
# constant price, industry level, oecd based, disaggregated prices
write.csv(zqd %>% select(contains("OECD")) %>% select(!contains("co2")),
file.path(here::here(),
"_dataset","ecp","industry","ecp_gloria_sectors",gversion,
"constantPrice","FixedXRate",
"ecp_gloria_oecd_industry_cpdisagg.csv"),row.names = F)
# constant price, demand level, edgar based, aggregate ecp, with carbon info
write.csv(yqd %>% select(year,country_sector,country,sector,EDGAR_ecp_all_all,contains("co2_edgar")) %>% rename(ecp_edgar = EDGAR_ecp_all_all),
file.path(here::here(),
"_dataset","ecp","industry","ecp_gloria_sectors",gversion,
"constantPrice","FixedXRate",
"ecp_gloria_edgar_finaldem_CO2.csv"),row.names = F)
# constant price, demand level, edgar based, disaggregated prices
write.csv(yqd %>% select(contains("EDGAR")) %>% select(!contains("co2")),
file.path(here::here(),
"_dataset","ecp","industry","ecp_gloria_sectors",gversion,
"constantPrice","FixedXRate",
"ecp_gloria_edgar_finaldem_cpdisagg.csv"),row.names = F)
# constant price, demand level, oecd based, aggregate ecp, with carbon info
write.csv(yqd %>% select(year,country_sector,country,sector,OECD_ecp_all_all,contains("co2_oecd")) %>% rename(ecp_oecd = OECD_ecp_all_all),
file.path(here::here(),
"_dataset","ecp","industry","ecp_gloria_sectors",gversion,
"constantPrice","FixedXRate",
"ecp_gloria_oecd_finaldem_CO2.csv"),row.names = F)
# constant price, demand level, oecd based, disaggregated prices
write.csv(yqd %>% select(contains("OECD")) %>% select(!contains("co2")),
file.path(here::here(),
"_dataset","ecp","industry","ecp_gloria_sectors",gversion,
"constantPrice","FixedXRate",
"ecp_gloria_oecd_finaldem_cpdisagg.csv"),row.names = F)
}
### clean up
unlink(file.path(wd,"1_import","ecp","tmpdir"),recursive = T)
unlink(file.path(wd,"1_import","gloria","tmpdir"),recursive = T)
unlink(file.path(wd,"2_match","tmpdir"),recursive = T)
rm(list=ls()[! ls() %in% c("wd","pl","gversion")])
### make checkplots
cbase<-"edgar"
source(file.path(wd,"3_checks","checkplots.R"))
cbase<-"oecd"
source(file.path(wd,"3_checks","checkplots.R"))
### clean up
rm(list=ls())
### Setup
wd<-file.path(here::here(),"_code","compilation","ecp","industry")
setwd(wd)
### Import data
gversion<-"059"
tmpmat=T
gloriawd<-file.path(wd,"1_import","gloria")
if(gversion=="059"){
if(isTRUE(tmpmat)){
source(file.path(gloriawd,"run_imports_v59_mat.R"))
} else {
source(file.path(gloriawd,"run_imports_v59.R"))
}
} else if(gversion=="057"){
source(file.path(gloriawd,"run_imports_v57.R"))
}
pl<-"curr_p"
ecpwd<-file.path(wd,"1_import","ecp")
source(file.path(ecpwd,"import_ecp.R"))
### Datamatch
ecpmwd<-file.path(wd,"2_match")
source(file.path(ecpmwd,"match_gloria_ecp.R"))
### Reformat and Save
for(j in 1:length(cpal)){
cpal[[j]]<-unlist(paste(cpal[[j]],collapse="_"))
}
cpinds<-unlist(cpal)
rm(cpal)
yrs<-seq(1990,2022)
zql<-list()
yql<-list()
for(i in 1:length(yrs)){
## 1. Fetch data
load(file.path(ecpmwd,"tmpdir",yrs[i],"ecp_gloria.RData"))
## 2. Get industry level data
zqdf<-as.data.frame(matrix(nrow=nrow(sequential_ind),ncol=4))
colnames(zqdf)<-c("year","country_sector","country","sector")
zqdf$year<-yrs[i]
zqdf$country_sector<-sequential_ind$Sequential_regionSector_labels
zqdf$country<-sequential_ind$fcq
zqdf$sector<-sequential_ind$fsq
# find carbon prices and bind to zqdf
nrcps<-nrow(satellites_ind)+1
nrcpf<-nrow(satellites_ind)+length(cpinds)
zcp<-t(zq[nrcps:nrcpf,])
colnames(zcp)<-cpinds
zqdf<-cbind(zqdf,zcp)
rm(nrcps,nrcpf,zcp)
# add emissions columns
zqdf['co2_edgar_total']<-zq[which(grepl("EDGAR",satellites_ind$Sat_head_indicator) & grepl("c_total",satellites_ind$Sat_indicator)),]
zqdf['co2_edgar_1a']<-zq[which(grepl("EDGAR",satellites_ind$Sat_head_indicator) & grepl("c_1A",satellites_ind$Sat_indicator)),] %>% colSums()
zqdf['co2_edgar_1b']<-zq[which(grepl("EDGAR",satellites_ind$Sat_head_indicator) & grepl("c_1B",satellites_ind$Sat_indicator)),] %>% colSums()
zqdf['co2_edgar_2']<-zq[which(grepl("EDGAR",satellites_ind$Sat_head_indicator) & grepl("c_2",satellites_ind$Sat_indicator)),] %>% colSums()
zqdf['co2_edgar_3']<-zq[which(grepl("EDGAR",satellites_ind$Sat_head_indicator) & grepl("c_3",satellites_ind$Sat_indicator)),] %>% colSums()
zqdf['co2_edgar_4']<-zq[which(grepl("EDGAR",satellites_ind$Sat_head_indicator) & grepl("c_4",satellites_ind$Sat_indicator)),] %>% colSums()
zqdf['co2_edgar_5']<-zq[which(grepl("EDGAR",satellites_ind$Sat_head_indicator) & grepl("c_5",satellites_ind$Sat_indicator)),] %>% colSums()
zqdf['co2_oecd_total']<-zq[which(grepl("OECD",satellites_ind$Sat_head_indicator) & grepl("c_total",satellites_ind$Sat_indicator)),]
zqdf['co2_oecd_1a']<-zq[which(grepl("OECD",satellites_ind$Sat_head_indicator) & grepl("c_1A",satellites_ind$Sat_indicator)),] %>% colSums()
zqdf['co2_oecd_1b']<-zq[which(grepl("OECD",satellites_ind$Sat_head_indicator) & grepl("c_1B",satellites_ind$Sat_indicator)),] %>% colSums()
zqdf['co2_oecd_2']<-zq[which(grepl("OECD",satellites_ind$Sat_head_indicator) & grepl("c_2",satellites_ind$Sat_indicator)),] %>% colSums()
zqdf['co2_oecd_3']<-zq[which(grepl("OECD",satellites_ind$Sat_head_indicator) & grepl("c_3",satellites_ind$Sat_indicator)),] %>% colSums()
zqdf['co2_oecd_4']<-zq[which(grepl("OECD",satellites_ind$Sat_head_indicator) & grepl("c_4",satellites_ind$Sat_indicator)),] %>% colSums()
zqdf['co2_oecd_5']<-zq[which(grepl("OECD",satellites_ind$Sat_head_indicator) & grepl("c_5",satellites_ind$Sat_indicator)),] %>% colSums()
# move into list element
zql[[i]]<-zqdf
rm(zqdf)
## 3. Get demand level data
yqdf<-as.data.frame(matrix(nrow=nrow(sequentiald_ind),ncol=4))
colnames(yqdf)<-c("year","country_sector","country","sector")
yqdf$year<-yrs[i]
yqdf$country_sector<-sequentiald_ind$Sequential_finalDemand_labels
yqdf$country<-sequentiald_ind$fcqd
yqdf$sector<-sequentiald_ind$demandind
# find carbon prices and bind to yqdf
nrcps<-nrow(satellites_ind)+1
nrcpf<-nrow(satellites_ind)+length(cpinds)
ycp<-t(yq[nrcps:nrcpf,])
colnames(ycp)<-cpinds
yqdf<-cbind(yqdf,ycp)
rm(nrcps,nrcpf,ycp)
# total emissions row is given by satellites_ind
# add emissions columns
yqdf['co2_edgar_total']<-yq[which(grepl("EDGAR",satellites_ind$Sat_head_indicator) & grepl("c_total",satellites_ind$Sat_indicator)),]
yqdf['co2_edgar_1a']<-yq[which(grepl("EDGAR",satellites_ind$Sat_head_indicator) & grepl("c_1A",satellites_ind$Sat_indicator)),] %>% colSums()
yqdf['co2_edgar_1b']<-yq[which(grepl("EDGAR",satellites_ind$Sat_head_indicator) & grepl("c_1B",satellites_ind$Sat_indicator)),] %>% colSums()
yqdf['co2_edgar_2']<-yq[which(grepl("EDGAR",satellites_ind$Sat_head_indicator) & grepl("c_2",satellites_ind$Sat_indicator)),] %>% colSums()
yqdf['co2_edgar_3']<-yq[which(grepl("EDGAR",satellites_ind$Sat_head_indicator) & grepl("c_3",satellites_ind$Sat_indicator)),] %>% colSums()
yqdf['co2_edgar_4']<-yq[which(grepl("EDGAR",satellites_ind$Sat_head_indicator) & grepl("c_4",satellites_ind$Sat_indicator)),] %>% colSums()
yqdf['co2_edgar_5']<-yq[which(grepl("EDGAR",satellites_ind$Sat_head_indicator) & grepl("c_5",satellites_ind$Sat_indicator)),] %>% colSums()
yqdf['co2_oecd_total']<-yq[which(grepl("OECD",satellites_ind$Sat_head_indicator) & grepl("c_total",satellites_ind$Sat_indicator)),]
yqdf['co2_oecd_1a']<-yq[which(grepl("OECD",satellites_ind$Sat_head_indicator) & grepl("c_1A",satellites_ind$Sat_indicator)),] %>% colSums()
yqdf['co2_oecd_1b']<-yq[which(grepl("OECD",satellites_ind$Sat_head_indicator) & grepl("c_1B",satellites_ind$Sat_indicator)),] %>% colSums()
yqdf['co2_oecd_2']<-yq[which(grepl("OECD",satellites_ind$Sat_head_indicator) & grepl("c_2",satellites_ind$Sat_indicator)),] %>% colSums()
yqdf['co2_oecd_3']<-yq[which(grepl("OECD",satellites_ind$Sat_head_indicator) & grepl("c_3",satellites_ind$Sat_indicator)),] %>% colSums()
yqdf['co2_oecd_4']<-yq[which(grepl("OECD",satellites_ind$Sat_head_indicator) & grepl("c_4",satellites_ind$Sat_indicator)),] %>% colSums()
yqdf['co2_oecd_5']<-yq[which(grepl("OECD",satellites_ind$Sat_head_indicator) & grepl("c_5",satellites_ind$Sat_indicator)),] %>% colSums()
# move into list element
yql[[i]]<-yqdf
rm(yqdf)
}
zqd<-do.call("rbind",zql)
yqd<-do.call("rbind",yql)
# we save seperate these files separately due to GitHub restrictions on file size
if(pl=="curr_p"){
# current price, industry level, edgar based, aggregate ecp, with carbon info
write.csv(zqd %>% select(year,country_sector,country,sector,EDGAR_ecp_all_all,contains("co2_edgar")) %>% rename(ecp_edgar = EDGAR_ecp_all_all),
file.path(here::here(),
"_dataset","ecp","industry","ecp_gloria_sectors",gversion,
"currentPrice","FlexXRate",
"ecp_gloria_edgar_industry_CO2.csv"),row.names = F)
# current price, industry level, edgar based, disaggregated prices
write.csv(zqd %>% select(contains("EDGAR")) %>% select(!contains("co2")),
file.path(here::here(),
"_dataset","ecp","industry","ecp_gloria_sectors",gversion,
"currentPrice","FlexXRate",
"ecp_gloria_edgar_industry_cpdisagg.csv"),row.names = F)
# current price, industry level, oecd based, aggregate ecp, with carbon info
write.csv(zqd %>% select(year,country_sector,country,sector,OECD_ecp_all_all,contains("co2_oecd")) %>% rename(ecp_oecd = OECD_ecp_all_all),
file.path(here::here(),
"_dataset","ecp","industry","ecp_gloria_sectors",gversion,
"currentPrice","FlexXRate",
"ecp_gloria_oecd_industry_CO2.csv"),row.names = F)
# current price, industry level, oecd based, disaggregated prices
write.csv(zqd %>% select(contains("OECD")) %>% select(!contains("co2")),
file.path(here::here(),
"_dataset","ecp","industry","ecp_gloria_sectors",gversion,
"currentPrice","FlexXRate",
"ecp_gloria_oecd_industry_cpdisagg.csv"),row.names = F)
# current price, demand level, edgar based, aggregate ecp, with carbon info
write.csv(yqd %>% select(year,country_sector,country,sector,EDGAR_ecp_all_all,contains("co2_edgar")) %>% rename(ecp_edgar = EDGAR_ecp_all_all),
file.path(here::here(),
"_dataset","ecp","industry","ecp_gloria_sectors",gversion,
"currentPrice","FlexXRate",
"ecp_gloria_edgar_finaldem_CO2.csv"),row.names = F)
# current price, demand level, edgar based, disaggregated prices
write.csv(yqd %>% select(contains("EDGAR")) %>% select(!contains("co2")),
file.path(here::here(),
"_dataset","ecp","industry","ecp_gloria_sectors",gversion,
"currentPrice","FlexXRate",
"ecp_gloria_edgar_finaldem_cpdisagg.csv"),row.names = F)
# current price, demand level, oecd based, aggregate ecp, with carbon info
write.csv(yqd %>% select(year,country_sector,country,sector,OECD_ecp_all_all,contains("co2_oecd")) %>% rename(ecp_oecd = OECD_ecp_all_all),
file.path(here::here(),
"_dataset","ecp","industry","ecp_gloria_sectors",gversion,
"currentPrice","FlexXRate",
"ecp_gloria_oecd_finaldem_CO2.csv"),row.names = F)
# current price, demand level, oecd based, disaggregated prices
write.csv(yqd %>% select(contains("OECD")) %>% select(!contains("co2")),
file.path(here::here(),
"_dataset","ecp","industry","ecp_gloria_sectors",gversion,
"currentPrice","FlexXRate",
"ecp_gloria_oecd_finaldem_cpdisagg.csv"),row.names = F)
} else if (pl=="cons_p"){
# constant price, industry level, edgar based, aggregate ecp, with carbon info
write.csv(zqd %>% select(year,country_sector,country,sector,EDGAR_ecp_all_all,contains("co2_edgar")) %>% rename(ecp_edgar = EDGAR_ecp_all_all),
file.path(here::here(),
"_dataset","ecp","industry","ecp_gloria_sectors",gversion,
"constantPrice","FixedXRate",
"ecp_gloria_edgar_industry_CO2.csv"),row.names = F)
# constant price, industry level, edgar based, disaggregated prices
write.csv(zqd %>% select(contains("EDGAR")) %>% select(!contains("co2")),
file.path(here::here(),
"_dataset","ecp","industry","ecp_gloria_sectors",gversion,
"constantPrice","FixedXRate",
"ecp_gloria_edgar_industry_cpdisagg.csv"),row.names = F)
# constant price, industry level, oecd based, aggregate ecp, with carbon info
write.csv(zqd %>% select(year,country_sector,country,sector,OECD_ecp_all_all,contains("co2_oecd")) %>% rename(ecp_oecd = OECD_ecp_all_all),
file.path(here::here(),
"_dataset","ecp","industry","ecp_gloria_sectors",gversion,
"constantPrice","FixedXRate",
"ecp_gloria_oecd_industry_CO2.csv"),row.names = F)
# constant price, industry level, oecd based, disaggregated prices
write.csv(zqd %>% select(contains("OECD")) %>% select(!contains("co2")),
file.path(here::here(),
"_dataset","ecp","industry","ecp_gloria_sectors",gversion,
"constantPrice","FixedXRate",
"ecp_gloria_oecd_industry_cpdisagg.csv"),row.names = F)
# constant price, demand level, edgar based, aggregate ecp, with carbon info
write.csv(yqd %>% select(year,country_sector,country,sector,EDGAR_ecp_all_all,contains("co2_edgar")) %>% rename(ecp_edgar = EDGAR_ecp_all_all),
file.path(here::here(),
"_dataset","ecp","industry","ecp_gloria_sectors",gversion,
"constantPrice","FixedXRate",
"ecp_gloria_edgar_finaldem_CO2.csv"),row.names = F)
# constant price, demand level, edgar based, disaggregated prices
write.csv(yqd %>% select(contains("EDGAR")) %>% select(!contains("co2")),
file.path(here::here(),
"_dataset","ecp","industry","ecp_gloria_sectors",gversion,
"constantPrice","FixedXRate",
"ecp_gloria_edgar_finaldem_cpdisagg.csv"),row.names = F)
# constant price, demand level, oecd based, aggregate ecp, with carbon info
write.csv(yqd %>% select(year,country_sector,country,sector,OECD_ecp_all_all,contains("co2_oecd")) %>% rename(ecp_oecd = OECD_ecp_all_all),
file.path(here::here(),
"_dataset","ecp","industry","ecp_gloria_sectors",gversion,
"constantPrice","FixedXRate",
"ecp_gloria_oecd_finaldem_CO2.csv"),row.names = F)
# constant price, demand level, oecd based, disaggregated prices
write.csv(yqd %>% select(contains("OECD")) %>% select(!contains("co2")),
file.path(here::here(),
"_dataset","ecp","industry","ecp_gloria_sectors",gversion,
"constantPrice","FixedXRate",
"ecp_gloria_oecd_finaldem_cpdisagg.csv"),row.names = F)
}
### clean up
unlink(file.path(wd,"1_import","ecp","tmpdir"),recursive = T)
unlink(file.path(wd,"1_import","gloria","tmpdir"),recursive = T)
unlink(file.path(wd,"2_match","tmpdir"),recursive = T)
rm(list=ls()[! ls() %in% c("wd","pl","gversion")])
### make checkplots
cbase<-"edgar"
source(file.path(wd,"3_checks","checkplots.R"))
cbase<-"oecd"
source(file.path(wd,"3_checks","checkplots.R"))
### clean up
rm(list=ls())
